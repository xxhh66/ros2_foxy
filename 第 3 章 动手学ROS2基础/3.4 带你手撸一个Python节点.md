# [3.4.1 创建工作空间和功能包](https://fishros.com/d2lros2foxy/#/chapt3/3.5.1创建工作空间和功能包?id=_341-创建工作空间和功能包)

节点需要存在于功能包当中、功能包需要存在于工作空间当中。所以我们要想创建节点，就要先创建一个工作空间，再创建功能包。

## [1 创建工作空间](https://fishros.com/d2lros2foxy/#/chapt3/3.5.1创建工作空间和功能包?id=_1-创建工作空间)

工作空间就是文件夹，所以很简单

```
mkdir -p town_ws/src
cd town_ws/src
```

## [2.创建一个功能包](https://fishros.com/d2lros2foxy/#/chapt3/3.5.1创建工作空间和功能包?id=_2创建一个功能包)

我们先讲一下如何创建一个名字叫做`village_li `(李家村)python版本的功能包。

```
ros2 pkg create village_li --build-type ament_python --dependencies rclpy
```

大家可以手写一下这个代码，感受一下。现在小鱼来讲一讲这条命令的含义和参数。

- pkg create 是创建包的意思
- --build-type 用来指定该包的编译类型，一共有三个可选项`ament_python`、`ament_cmake`、`cmake`
- --dependencies 指的是这个功能包的依赖，这里小鱼给了一个ros2的python客户端接口`rclpy`

> 如果build-type什么都不写，ros2会默认类型为ament_cmake.

最后你可以得到这样一个目录结构。

![image-20210727125747458](assets/image-20210727125747458.png)

## [3.创建节点文件](https://fishros.com/d2lros2foxy/#/chapt3/3.5.1创建工作空间和功能包?id=_3创建节点文件)

接下来我们开始编写一个python节点，首先在`__init__.py`同级别目录下创建一个叫做`li4.py`的文件(在vscode中右击新建就行)。

创建完成后的目录结构长这样子

![image-20210727125908746](assets/image-20210727125908746.png)

# [3.4.2 使用非OOP方法编写一个节点](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=_342-使用非oop方法编写一个节点)

创建好了`li4.py`，接着我们就可以正式编写代码。大家看到我们的标题是使用非OOP方法编写节点，OOP就是所谓的面向对象编程，如果你不理解也没关系，小鱼下面会跟大家一一讲解。

## [1.开始编写程序](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=_1开始编写程序)

编写ROS2节点的一般步骤

1. 导入库文件
2. 初始化客户端库
3. 新建节点
4. spin循环节点
5. 关闭客户端库

打开li4.py,接着我们开始编写代码。跟着小鱼一起边理解输入下面的代码，注释不用输。

```
import rclpy
from rclpy.node import Node

def main(args=None):
    """
    ros2运行该节点的入口函数
    编写ROS2节点的一般步骤
    1. 导入库文件
    2. 初始化客户端库
    3. 新建节点对象
    4. spin循环节点
    5. 关闭客户端库
    """
    rclpy.init(args=args) # 初始化rclpy
    node = Node("li4")  # 新建一个节点
    node.get_logger().info("大家好，我是作家li4.")
    rclpy.spin(node) # 保持节点运行，检测是否收到退出指令（Ctrl+C）
    rclpy.shutdown() # 关闭rclpy
```

代码编写完成用Crtl+S进行保存。接着修改`setup.py`

增加一句话，告诉ros2村庄来了一位新村民李四，要找这位村民去`village_li.li4:main`路径下寻找。

```
    entry_points={
        'console_scripts': [
            "li4_node = village_li.li4:main"
        ],
    },
)
```

完成上面的工作后，就可以编译运行了。

## [2.编译运行节点](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=_2编译运行节点)

打开vscode终端，进入`town_ws`

### [编译节点](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=编译节点)

```
colcon build
```

### [source环境](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=source环境)

```
source install/setup.bash
```

### [运行节点](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=运行节点)

```
ros2 run village_li li4_node
```

### [运行结果](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=运行结果)

![image-20210727134002735](assets/image-20210727134002735.png)

## [3.总结](https://fishros.com/d2lros2foxy/#/chapt3/3.5.2使用非OOP方法编写一个节点并测试?id=_3总结)

当节点运行起来后，可以再尝试使用`ros2 node list `指令来查看现有的节点。这个时候你应该能看到：

![image-20210727135236470](assets/image-20210727135236470.png)

这说明你的节点已经运行起来了。

# [3.4.3 OOP介绍](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_343-oop介绍-1)

除了使用上节中的只定义一个main函数就完成编写一个Python节点外，还有另外两种方式。

本节小鱼就来讲一讲出现么多种编写节点的原因，并对其中较为重要的OOP方法进行介绍。

要做机器人离不开计算机编程，而计算机编程经过多年的发展，演变出了三种不同且常用的编程思想，分别是：

1. 面向过程编程思想。缩写：POP
2. 面向对象编程思想。缩写：OOP
3. 函数式思想。缩写：FP

## [1.Why](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_1why-1)

为什么了解这些编程思想呢？尤其是OOP。

小鱼遇到过很多同学，在阅读机器人相关开源程序代码时，比如导航框架Nav2、机械臂运动控制框架Moveit时发现，别人的代码，每一行好像都看得懂，但放一起就看不懂了，看别人函数调来调去，很快人就给整蒙了。不知道如何下手。

这其实就是对别人的编程思想不了解造成的，所以本节课小鱼就给提一提常见的三种编程思想，让大家脑子里有个概念，以后遇到了看不明白的程序，知道该往哪个方向去学习。

编程思想博大精深，小鱼这里只是对三种思想的基本介绍。

## [2.思想辨析](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_2思想辨析-1)

首先明确一件事情，编程是为了什么？

是为了赚钱吗？

不，我们写程序肯定是为了解决实际的问题的，那编程思想编程思想就是解决问题的思路（赚钱工具）

那这三种思想有什么区别呢？

### [2.1 用三种思想把大象装进冰箱](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_21-用三种思想把大象装进冰箱-1)

比如我们想把一只大象装进冰箱，分别用三种思想，我们看看有什么不一样。

![image-20210918165813562](assets/image-20210918165813562.png)

#### [2.1.1 面向过程思想](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_211-面向过程思想-1)

如果我们采用面向过程的思想，可以分为三步：

1. 打开冰箱门
2. 把大象塞进去
3. 关上冰箱门

面向过程编程就是分析出解决问题所需要步骤，然后分别实现每一步，再一步步执行即可。

#### [2.1.2 面向对象思想](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_212-面向对象思想-1)

面向对象编程思想（OOP）怎么做呢？

那就要先知道面向对象是什么？搞清楚啥是对象？

![面向对象编程](assets/3381e4c0ca704f4ba817d12e18b5ebe6.jpeg)

对象是女朋友吗？答案肯定不是。

任何我们想要探究的事物都可以当作一个对象，比如我们可以把你家的冰箱理解为一个对象，我们就可以研究你家冰箱由哪些部分（指令装置等）组成，你家冰箱能干什么（制冷、调温等）？

接着我们开始下定义，就是取个高大上的名字

| 冰箱           | 定义       | 举例                     |
| -------------- | ---------- | ------------------------ |
| 冰箱的组成部分 | 冰箱的属性 | 制冷器，调温旋钮、灯带等 |
| 冰箱能干什么   | 冰箱的行为 | 制冷，调温、照明等       |

对象的行为其实是对其属性的操作，比如对制冷器操作就可以制冷，给灯带通电就可以照明。

**对象 = 属性+行为**

接着我们开始采用OOP的方法把大象装进冰箱

1. 调用：冰箱->打开门(行为)
2. 调用：冰箱->装东西(行为)
3. 调用：冰箱->关闭门(行为)

看起来和面向过程没啥区别，但我们的思想发生了重大的转变，我们把冰箱当作了一个独立的对象，我们是通过和冰箱这个对象交互完成了整个过程。

接着来看函数式编程

1. 定义关进（冰箱，大象）函数
2. 实现函数：关门(放入(开门(冰箱)，大象))

可以看到多层的函数嵌套调用，这就是函数编程的魅力，因为FP不是我们的机器人学习中的重点，这里就不过多讲解啦！

## [3.面向对象编程](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_3面向对象编程)

简单介绍完，我们来说说今天的主角，面向对象编程OOP。

面向对象中有五个重要的概念，理解这五个概念相当于对OOP编程有了了解，下面小鱼一个个来介绍。

### [3.1 类与对象（抽象与具体）](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_31-类与对象（抽象与具体）)

我们通过调用你家美的冰箱的开门、装东西和关门三个行为来把大象装进冰箱。这时我们可以把`你家的美的冰箱`（具体的）称之为一个对象，而冰箱（抽象的）就称为一个类。

比如说鱼类和小鱼，鱼类就是一个类，而小鱼就是鱼类（抽象的）中的一个对象（具体的）。

在ROS2设计时这种抽象和具体的思想发挥着非常重要的作用，比如说DDS是有很多厂家的，ROS2为了匹配不同厂家的DDS，就设计除了DDS抽象层，而每一个具体的DDS厂家，我们可以称之为一个DDS的对象，是具体的。

### [3.2 封装、继承与多态](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_32-封装、继承与多态)

所谓封装就是将属性和行为封装在一起。上面已经介绍了**对象 = 属性+行为**，比如冰箱将冰箱的温度值（属性）和对温度值的操作（行为）等封装在一起。

继承，继承可以帮我们减少很多的工作量（比如王撕聪从他爹那里继承了很多钱，这样他就少奋斗了很多年），比如ROS2中的执行器类，通过继承执行器类实现了单线程执行器和多线程执行器，更多具体的例子我们在后续的学习中遇到再说。

多态，其实很简单，我们可以说鲤鱼是鱼类，草鱼是鱼类，章鱼是鱼类。同一个鱼类可以有多种不同的类型，即多态。更多的用法，等到写代码的时候再和小鱼一起解锁

## [4.如何选择code思想](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_4如何选择code思想)

三种编程思想，我们写程序的时候该如何选择呢?

小鱼个人的拙见是根据你的功能需求来，如果只需要实现一个很简单的功能，比如只是做一个键盘控制器，实现控制小车前进后退，直接采用面向过程的设计思想即可。但如果是做一个稍大的工程，且后续要考虑功能的拓展性，这个时候就需要采用面向对象的思路来了。

那小鱼后续的课程会采用哪一种编程思想呢？

答案是面向对象的方式，原因在于

- 带大家熟悉面向对象的套路有利于大家对ROS2源码和开源代码进行阅读 
- 有助于培养大家工程化的能力和模块化的思想

## [5.总结](https://fishros.com/d2lros2foxy/#/chapt3/3.5.3OOP介绍?id=_5总结)

下节课小鱼将带大家一起采用面向对象的编程思想重构实现一下李四节点。

------

参考链接：

-[浅谈面向对象的编程思想：如何优雅地把大象装进冰箱？_SYSU_101的博客-CSDN博客](https://blog.csdn.net/SYSU_101/article/details/78057008)

## [3.4.4 使用OOP方法编实现作家李四](https://fishros.com/d2lros2foxy/#/chapt3/3.5.4使用OOP方法编实现作家李四?id=_344-使用oop方法编实现作家李四)

打开li4.py,接着我们开始修改代码。跟着小鱼一起边理解输入下面的代码，注释不用输。

```
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node


class WriterNode(Node):
    """
    创建一个作家节点，并在初始化时输出一个话
    """
    def __init__(self,name):
        super().__init__(name)
        self.get_logger().info("大家好，我是%s,我是一名作家！" % name)


def main(args=None):
    """
    ros2运行该节点的入口函数
    1. 导入库文件
    2. 初始化客户端库
    3. 新建节点
    4. spin循环节点
    5. 关闭客户端库
    """
    rclpy.init(args=args) # 初始化rclpy
    node = WriterNode("li4")  # 新建一个节点
    rclpy.spin(node) # 保持节点运行，检测是否收到退出指令（Ctrl+C）
    rclpy.shutdown() # 关闭rclpy
```

代码编写完成用Crtl+S进行保存。接着修改`setup.py`

增加一句话，告诉ros2村庄来了一位新村民李四，要找这位村民去`village_li.li4:main`路径下寻找。

```
    entry_points={
        'console_scripts': [
            "li4_node = village_li.li4:main"
        ],
    },
)
```

完成上面的工作后，就可以编译运行了。

## [3.编译运行节点](https://fishros.com/d2lros2foxy/#/chapt3/3.5.4使用OOP方法编实现作家李四?id=_3编译运行节点)

打开vscode终端，进入`town_ws`

### [编译节点](https://fishros.com/d2lros2foxy/#/chapt3/3.5.4使用OOP方法编实现作家李四?id=编译节点)

```
colcon build
```

### [source环境](https://fishros.com/d2lros2foxy/#/chapt3/3.5.4使用OOP方法编实现作家李四?id=source环境)

```
source install/setup.bash
```

### [运行节点](https://fishros.com/d2lros2foxy/#/chapt3/3.5.4使用OOP方法编实现作家李四?id=运行节点)

```
ros2 run village_li li4_node
```

### [运行结果](https://fishros.com/d2lros2foxy/#/chapt3/3.5.4使用OOP方法编实现作家李四?id=运行结果)

![image-20210727134002735](assets/image-20210727134002735-176699395449522.png)

## [4.总结](https://fishros.com/d2lros2foxy/#/chapt3/3.5.4使用OOP方法编实现作家李四?id=_4总结)

当节点运行起来后，可以再尝试使用`ros2 node list `指令来查看现有的节点。这个时候你应该能看到：

![image-20210727135236470](assets/image-20210727135236470-176699395681424.png)

这说明你的节点已经运行起来了，并且被其他节点感知到了。

这一节，小鱼带你一起使用Python完成了python节点的编写，成功创建出来一个li4的节点。下一节小鱼带你一起去王家村，来创建单身汉王二，让我们一起加油吧~